<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ°´ç­çŸ¿å·¥ 3D æ‹Ÿç‰©ç‰ˆ</title>
    <style>
        body { margin: 0; padding: 0; background: #1a1a1a; font-family: 'PingFang SC', sans-serif; touch-action: none; overflow: hidden; }
        /* å¢åŠ æ³¥åœŸè´¨æ„ŸèƒŒæ™¯ */
        canvas { display: block; background: radial-gradient(circle, #8b4513 0%, #4d260b 100%); margin: 0 auto; }
        #info { 
            position: absolute; top: 20px; left: 20px; color: #f1c40f; 
            font-size: 28px; font-weight: bold; pointer-events: none;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    <div id="info">ğŸ’° å¾—åˆ†: <span id="score">0</span></div>
    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let score = 0;
let angle = 0;
let direction = 1;
let hookState = "swing"; 
let hookLen = 50;
let currentItem = null; 

const originX = canvas.width / 2;
const originY = 70;
const baseSpeed = 8; 

let items = [];

function initItems() {
    items = [];
    for(let i=0; i<12; i++) {
        let size = Math.random() * 40 + 25;
        let isStone = Math.random() > 0.4; 
        items.push({
            x: Math.random() * (canvas.width - 80) + 40,
            y: Math.random() * (canvas.height - 300) + 200,
            r: size,
            weight: isStone ? size * 0.35 : size * 0.2, // çŸ³å¤´æ˜¾è‘—æ›´é‡
            isStone: isStone,
            val: isStone ? -Math.floor(size) : Math.floor(size * 3) 
        });
    }
}

function update() {
    if (hookState === "swing") {
        angle += 0.04 * direction;
        if (Math.abs(angle) > 1.3) direction *= -1;
    } 
    else if (hookState === "extend") {
        hookLen += baseSpeed;
        if (hookLen > canvas.height - 50) hookState = "retract";
        
        let hX = originX + Math.sin(angle) * hookLen;
        let hY = originY + Math.cos(angle) * hookLen;

        for (let i = 0; i < items.length; i++) {
            let item = items[i];
            let dx = hX - item.x;
            let dy = hY - item.y;
            if (Math.sqrt(dx*dx + dy*dy) < item.r) {
                currentItem = items.splice(i, 1)[0];
                hookState = "retract";
                break; 
            }
        }
    } 
    else if (hookState === "retract") {
        let speedReduce = currentItem ? currentItem.weight : 0;
        hookLen -= Math.max(1.5, baseSpeed - speedReduce); 

        if (hookLen <= 50) {
            if (currentItem) {
                score += currentItem.val;
                scoreEl.innerText = score;
                currentItem = null;
            }
            hookLen = 50;
            hookState = "swing";
        }
    }
}

// æ ¸å¿ƒæ”¹è¿›ï¼š3D æ‹Ÿç‰©ç»˜åˆ¶
function drawItem(item) {
    ctx.save();
    // æ·»åŠ é˜´å½±ï¼Œæ¨¡æ‹Ÿ 3D æ‚¬æµ®æ„Ÿ
    ctx.shadowBlur = 15;
    ctx.shadowColor = "rgba(0,0,0,0.5)";
    ctx.shadowOffsetY = 10;

    // ç»˜åˆ¶å†…å®¹
    ctx.font = `${item.r * 1.5}px serif`;
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    
    // æ ¹æ®ç±»å‹æ˜¾ç¤º Emoji
    const content = item.isStone ? "ğŸª¨" : "ğŸ’°";
    ctx.fillText(content, item.x, item.y);
    
    ctx.restore();
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // 1. ç»˜åˆ¶æ°´ç­ ğŸ¦¦
    ctx.font = "60px serif";
    ctx.textAlign = "center";
    ctx.fillText("ğŸ¦¦", originX, originY);
    
    let hX = originX + Math.sin(angle) * hookLen;
    let hY = originY + Math.cos(angle) * hookLen;
    
    // 2. ç»˜åˆ¶ 3D æ‹Ÿç‰©ç»³ç´¢ (ä½¿ç”¨æ¸å˜)
    let ropeGrad = ctx.createLinearGradient(originX, originY, hX, hY);
    ropeGrad.addColorStop(0, "#5d2906");
    ropeGrad.addColorStop(0.5, "#d35400"); // ä¸­é—´äº®è‰²ï¼Œæ¨¡æ‹Ÿé«˜å…‰åœ†æŸ±
    ropeGrad.addColorStop(1, "#5d2906");
    
    ctx.beginPath();
    ctx.moveTo(originX, originY + 15);
    ctx.lineTo(hX, hY);
    ctx.strokeStyle = ropeGrad;
    ctx.lineWidth = 4;
    ctx.lineCap = "round";
    ctx.stroke();

    // 3. ç»˜åˆ¶é’©å­æŠ“åˆ°çš„ç‰©ä½“
    if (currentItem) {
        currentItem.x = hX;
        currentItem.y = hY + (currentItem.r * 0.4);
        drawItem(currentItem);
    }

    // 4. ç»˜åˆ¶æ‰€æœ‰åœ°ä¸‹çŸ¿ç‰©
    items.forEach(drawItem);

    update();
    requestAnimationFrame(draw);
}

canvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    if (hookState === "swing") hookState = "extend";
}, {passive: false});

initItems();
draw();
</script>
</body>
</html>
