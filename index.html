<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ê∑±Êµ∑Ê∞¥Áç≠ÔºöÂÖ®ÁêÉÊâßË°åÁü©Èòµ</title>
    <style>
        :root { --neon-blue: #00f3ff; --neon-gold: #ffd700; }
        body { margin: 0; padding: 0; background: #001220; font-family: 'Segoe UI', sans-serif; touch-action: none; overflow: hidden; color: white; }
        
        .glass-panel { background: rgba(0, 243, 255, 0.05); border: 1px solid rgba(0, 243, 255, 0.2); backdrop-filter: blur(12px); border-radius: 15px; }

        /* ÂâçÁΩÆÂºïÂØºÈ°µ */
        #start-screen {
            position: absolute; inset: 0; z-index: 100;
            display: flex; flex-direction: column; align-items: center;
            padding: 40px 20px; background: radial-gradient(circle at center, #002b4d 0%, #00050a 100%);
        }
        
        #matrix-title { font-size: 28px; font-weight: bold; color: var(--neon-blue); text-shadow: 0 0 15px var(--neon-blue); margin-bottom: 30px; }
        .leaderboard { width: 100%; max-width: 400px; margin-bottom: 30px; }
        .region-item { display: flex; align-items: center; padding: 12px 20px; margin-bottom: 10px; justify-content: space-between; font-size: 14px; }
        .otter-swarm { color: #fff; font-size: 12px; opacity: 0.8; }

        #btn-start {
            padding: 15px 60px; font-size: 20px; font-weight: bold;
            background: var(--neon-blue); color: #001220; border: none;
            border-radius: 50px; cursor: pointer; transition: 0.3s;
            box-shadow: 0 0 25px var(--neon-blue);
        }

        /* ÂºπÂπïÊ†∑Âºè */
        #danmaku-container {
            position: absolute; top: 100px; width: 100%; height: 120px;
            pointer-events: none; overflow: hidden; z-index: 5;
        }
        .danmaku {
            position: absolute; white-space: nowrap; color: rgba(255, 255, 255, 0.6);
            font-size: 14px; animation: danmaku-move 8s linear forwards;
            text-shadow: 0 0 5px rgba(0, 243, 255, 0.5);
        }
        @keyframes danmaku-move {
            from { transform: translateX(100vw); }
            to { transform: translateX(-100%); }
        }

        /* Ê∏∏Êàè UI */
        #ui { position: absolute; top: 25px; left: 25px; color: var(--neon-blue); padding: 15px 25px; pointer-events: none; z-index: 10; display: none; }
        #lang-toggle { position: absolute; top: 25px; right: 25px; color: white; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); padding: 8px 15px; border-radius: 8px; cursor: pointer; z-index: 120; font-size: 14px; }
        canvas { display: block; margin: 0 auto; background: #001220; }
    </style>
</head>
<body>
    <button id="lang-toggle">English / ‰∏≠Êñá</button>
    <div id="danmaku-container"></div>

    <div id="start-screen">
        <div id="matrix-title">GLOBAL EXECUTION MATRIX</div>
        <div class="leaderboard" id="leaderboard-content"></div>
        <div style="flex-grow: 1; position: relative; width: 100%;"></div>
        <button id="btn-start">EXECUTE SYSTEM</button>
    </div>

    <div id="ui" class="glass-panel">
        <div class="stat" id="label-sector">Sector</div><span class="val" id="level">1</span>
        <div style="height: 10px;"></div>
        <div class="stat" id="label-credits">Credits</div><span class="val" id="score">0</span>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const levelEl = document.getElementById('level');
const langBtn = document.getElementById('lang-toggle');
const startBtn = document.getElementById('btn-start');
const startScreen = document.getElementById('start-screen');
const uiPanel = document.getElementById('ui');
const danmakuContainer = document.getElementById('danmaku-container');

const i18n = {
    en: { 
        sector: "Sector", credits: "Credits", start: "EXECUTE SYSTEM", title: "GLOBAL SYNC MATRIX",
        win: "So... now what?\nYou grabbed all the shiny bits.",
        danmaku: ["User 8821 reached Sector 10", "China player +1200 Credits", "A Founder just went bankrupt (Bomb)", "Strategy optimized...", "Stay focused, Otter."]
    },
    zh: { 
        sector: "Âå∫Âüü", credits: "ÁßØÂàÜ", start: "ÂºÄÂßãÊâßË°å", title: "ÂÖ®ÁêÉÂêåÊ≠•Áü©Èòµ",
        win: "ÁÑ∂ÂêéÂë¢...Ôºü\n‰Ω†ÊääÊâÄÊúâ‰∫ÆÊô∂Êô∂ÁöÑÈÉΩÊäìËµ∞‰∫Ü„ÄÇ",
        danmaku: ["Áî®Êà∑ 8821 Â∑≤Âà∞ËææÁ¨¨ 10 Âå∫Âüü", "‰∏≠ÂõΩÁé©ÂÆ∂Ëé∑Âæó +1200 ÁßØÂàÜ", "‰∏ÄÂêçÂàõ‰∏öËÄÖÂàöÂàöÂõ†ÁàÜÁÇ∏Á†¥‰∫ß", "ÊâßË°åÁ≠ñÁï•Â∑≤‰ºòÂåñ...", "‰øùÊåÅ‰∏ìÊ≥®ÔºåÊ∞¥Áç≠„ÄÇ"]
    }
};

const regionData = [
    { name: {zh: "‰∏≠ÂõΩ", en: "China"}, count: 12842, icons: "ü¶¶ü¶¶ü¶¶ü¶¶ü¶¶" },
    { name: {zh: "ÁæéÂõΩ", en: "USA"}, count: 8521, icons: "ü¶¶ü¶¶ü¶¶" },
    { name: {zh: "È©¨Êù•Ë•ø‰∫ö", en: "Malaysia"}, count: 4203, icons: "ü¶¶ü¶¶" },
    { name: {zh: "Âä†ÊãøÂ§ß", en: "Canada"}, count: 3912, icons: "ü¶¶" }
];

let currentLang = 'en', score = 0, currentLevel = 1, angle = 0, direction = 1;
let hookState = "swing", hookLen = 60, currentItem = null, isExploding = false, isWin = false, isPlaying = false;
const originX = canvas.width / 2, originY = 80, baseSpeed = 10;
let swingSpeed = 0.04, items = [];

// Ê∏≤ÊüìÂâçÁΩÆÊéíÂêç
function renderLeaderboard() {
    document.getElementById('leaderboard-content').innerHTML = regionData.map(r => `
        <div class="region-item glass-panel">
            <span>${r.name[currentLang]}</span>
            <span class="otter-swarm">${r.icons}</span>
            <span style="color:var(--neon-blue)">${r.count.toLocaleString()}</span>
        </div>
    `).join('');
    document.getElementById('matrix-title').innerText = i18n[currentLang].title;
    startBtn.innerText = i18n[currentLang].start;
}

// ÂºπÂπïÈÄªËæë
function sendDanmaku() {
    if(!isPlaying || isWin) return;
    const msg = i18n[currentLang].danmaku[Math.floor(Math.random() * i18n[currentLang].danmaku.length)];
    const el = document.createElement('div');
    el.className = 'danmaku';
    el.innerText = msg;
    el.style.top = Math.random() * 100 + 'px';
    danmakuContainer.appendChild(el);
    el.addEventListener('animationend', () => el.remove());
}
setInterval(sendDanmaku, 3000);

langBtn.addEventListener('click', () => {
    currentLang = currentLang === 'en' ? 'zh' : 'en';
    document.getElementById('label-sector').innerText = i18n[currentLang].sector;
    document.getElementById('label-credits').innerText = i18n[currentLang].credits;
    renderLeaderboard();
});

startBtn.addEventListener('click', () => {
    startScreen.style.display = 'none';
    uiPanel.style.display = 'block';
    isPlaying = true;
    initLevel(1);
    draw();
});

function initLevel(level) {
    if (level >= 10) { isWin = true; uiPanel.style.display = 'none'; return; }
    items = []; hookState = "swing"; hookLen = 60;
    swingSpeed = 0.035 + (level * 0.008);
    for(let i=0; i<4+Math.floor(level/2); i++) createObj("gold");
    for(let i=0; i<3+level; i++) createObj("stone");
    for(let i=0; i<Math.min(level, 6); i++) createObj("bomb");
}

function createObj(type) {
    items.push({
        x: Math.random() * (window.innerWidth - 100) + 50,
        y: Math.random() * (window.innerHeight - 350) + 250,
        r: type === "gold" ? 25 : (type === "stone" ? 30 : 35),
        type: type, weight: type === "stone" ? 7 : (type === "gold" ? 3 : 1),
        val: type === "gold" ? 100 : (type === "stone" ? -50 : 0)
    });
}

function drawWinScreen() {
    const time = Date.now() * 0.002;
    ctx.fillStyle = '#00050a'; ctx.fillRect(0, 0, canvas.width, canvas.height);
    const grad = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 0, canvas.width/2, canvas.height/2, canvas.width*0.8);
    grad.addColorStop(0, `rgba(0, 243, 255, ${0.1 + Math.sin(time)*0.05})`); grad.addColorStop(1, 'transparent');
    ctx.fillStyle = grad; ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.textAlign = "center"; ctx.textBaseline = "middle"; ctx.font = "bold 28px 'Segoe UI'";
    ctx.shadowBlur = 15; ctx.shadowColor = "cyan"; ctx.fillStyle = "white";
    const lines = i18n[currentLang].win.split('\n');
    lines.forEach((line, i) => ctx.fillText(line, canvas.width/2, canvas.height/2 - 40 + i*50));
    ctx.font = `${100 + Math.sin(time)*10}px serif`;
    ctx.fillText("ü¶¶", canvas.width/2, canvas.height/2 + 130);
    requestAnimationFrame(drawWinScreen);
}

function update() {
    if (!isPlaying || isWin) return;
    if (!items.find(i => i.type === "gold") && !currentItem && hookState === "swing") {
        currentLevel++; levelEl.innerText = currentLevel; initLevel(currentLevel); return;
    }
    if (hookState === "swing") {
        angle += swingSpeed * direction; if (Math.abs(angle) > 1.4) direction *= -1;
    } else if (hookState === "extend") {
        hookLen += baseSpeed; if (hookLen > canvas.height - 50) hookState = "retract";
        let hX = originX + Math.sin(angle) * hookLen, hY = originY + Math.cos(angle) * hookLen;
        for (let i = 0; i < items.length; i++) {
            let item = items[i];
            if (Math.sqrt((hX-item.x)**2 + (hY-item.y)**2) < item.r) {
                if (item.type === "bomb") { items.splice(i, 1); isExploding = true; score = 0; scoreEl.innerText = score; setTimeout(()=>isExploding=false, 600); hookState = "retract"; return; }
                currentItem = items.splice(i,1)[0]; hookState = "retract"; break;
            }
        }
    } else if (hookState === "retract") {
        hookLen -= Math.max(2, baseSpeed - (currentItem ? currentItem.weight : (isExploding ? -5 : 0)));
        if (hookLen <= 60) {
            if (currentItem) { score = Math.max(0, score + currentItem.val); scoreEl.innerText = score; currentItem = null; }
            hookLen = 60; hookState = "swing";
        }
    }
}

function draw() {
    if (isWin) { drawWinScreen(); return; }
    if (!isPlaying) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    canvas.width = window.innerWidth; canvas.height = window.innerHeight; // ÂìçÂ∫îÂºèÈÄÇÈÖç
    const grad = ctx.createRadialGradient(canvas.width/2, 0, 0, canvas.width/2, 0, canvas.height);
    grad.addColorStop(0, '#002b4d'); grad.addColorStop(1, '#001220');
    ctx.fillStyle = grad; ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.font = "60px serif"; ctx.textAlign = "center"; ctx.fillText("ü¶¶", canvas.width/2, originY);
    let hX = canvas.width/2 + Math.sin(angle) * hookLen, hY = originY + Math.cos(angle) * hookLen;
    ctx.beginPath(); ctx.moveTo(canvas.width/2, originY + 15); ctx.lineTo(hX, hY);
    ctx.strokeStyle = isExploding ? "#ff3e3e" : "rgba(0, 243, 255, 0.6)"; ctx.lineWidth = 2; ctx.setLineDash([5, 5]); ctx.stroke(); ctx.setLineDash([]);
    ctx.save(); ctx.translate(hX, hY); ctx.rotate(-angle); ctx.font = "30px serif"; ctx.fillText("ü™ù", 0, 15); ctx.restore();
    if (isExploding) { ctx.font = "80px serif"; ctx.fillText("üí•", hX, hY); }
    if (currentItem) { currentItem.x = hX; currentItem.y = hY + 30; drawItem(currentItem); }
    items.forEach(drawItem);
    update(); requestAnimationFrame(draw);
}

function drawItem(item) {
    ctx.save(); ctx.font = `${item.r * 1.2}px serif`; ctx.textAlign = "center"; ctx.textBaseline = "middle";
    ctx.shadowBlur = 20; ctx.shadowColor = item.type === "gold" ? "gold" : (item.type === "bomb" ? "red" : "transparent");
    ctx.fillText(item.type === "gold" ? "üí∞" : (item.type === "stone" ? "ü™®" : "üí£"), item.x, item.y);
    ctx.restore();
}

window.addEventListener('mousedown', (e) => { 
    if (e.target.id !== 'lang-toggle' && e.target.id !== 'btn-start' && hookState === "swing" && isPlaying && !isWin) hookState = "extend"; 
});
canvas.addEventListener('touchstart', (e) => { e.preventDefault(); if (hookState === "swing" && isPlaying && !isWin) hookState = "extend"; }, {passive: false});

renderLeaderboard();
</script>
</body>
</html>
