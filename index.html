<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ·±æµ·æ°´ç­çŸ¿å·¥ - Abstract DeepSea</title>
    <style>
        :root { --neon-blue: #00f3ff; --neon-gold: #ffd700; }
        body { margin: 0; padding: 0; background: #001220; font-family: 'Segoe UI', sans-serif; touch-action: none; overflow: hidden; }
        
        /* æŠ½è±¡ç²¾è‡´ UI */
        #ui { 
            position: absolute; top: 25px; left: 25px; color: var(--neon-blue); 
            background: rgba(0, 243, 255, 0.1); padding: 15px 25px;
            border-radius: 15px; border: 1px solid rgba(0, 243, 255, 0.3);
            backdrop-filter: blur(10px); pointer-events: none;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }
        /* è¯­è¨€åˆ‡æ¢æŒ‰é’® - å”¯ä¸€å¯ç‚¹å‡»çš„ UI */
        #lang-toggle {
            position: absolute; top: 25px; right: 25px; color: white;
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 15px; border-radius: 8px; cursor: pointer; z-index: 20;
            font-size: 14px; backdrop-filter: blur(5px);
        }
        .stat { font-size: 12px; text-transform: uppercase; letter-spacing: 2px; opacity: 0.8; }
        .val { font-size: 24px; font-weight: bold; color: white; display: block; }

        canvas { display: block; margin: 0 auto; background: radial-gradient(circle at top, #002b4d 0%, #001220 100%); }
    </style>
</head>
<body>
    <button id="lang-toggle">English / ä¸­æ–‡</button>
    <div id="ui">
        <div class="stat" id="label-sector">Sector</div><span class="val" id="level">1</span>
        <div style="height: 10px;"></div>
        <div class="stat" id="label-credits">Credits</div><span class="val" id="score">0</span>
    </div>
    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const levelEl = document.getElementById('level');
const langBtn = document.getElementById('lang-toggle');

// è¯­è¨€å­—å…¸
const i18n = {
    en: {
        sector: "Sector",
        credits: "Credits",
        story:"So... now what? You grabbed all the shiny bits."
            
    },
    zh: {
        sector: "åŒºåŸŸ",
        credits: "ç§¯åˆ†",
        story: "ç„¶åå‘¢...ï¼Ÿä½ æŠŠæ‰€æœ‰äº®æ™¶æ™¶çš„éƒ½æŠ“èµ°äº†ã€‚"
    }
};

let currentLang = 'en';

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let score = 0;
let currentLevel = 1;
let angle = 0;
let direction = 1;
let hookState = "swing"; 
let hookLen = 60;
let currentItem = null; 
let isExploding = false;
let isWin = false;

const originX = canvas.width / 2;
const originY = 80;
let swingSpeed = 0.04;
const baseSpeed = 10;
let items = [];

// è¯­è¨€åˆ‡æ¢é€»è¾‘
langBtn.addEventListener('click', () => {
    currentLang = currentLang === 'en' ? 'zh' : 'en';
    updateUILabels();
});

function updateUILabels() {
    document.getElementById('label-sector').innerText = i18n[currentLang].sector;
    document.getElementById('label-credits').innerText = i18n[currentLang].credits;
}

function initLevel(level) {
    if (level >= 2) {
        isWin = true;
        document.getElementById('ui').style.display = 'none';
        document.getElementById('lang-toggle').style.display = 'none';
        return;
    }
    items = [];
    hookState = "swing";
    hookLen = 60;
    swingSpeed = 0.035 + (level * 0.008);
    
    let goldCount = 4 + Math.floor(level/2);
    let stoneCount = 3 + level;
    let bombCount = Math.min(level, 6);

    for(let i=0; i<goldCount; i++) createObj("gold");
    for(let i=0; i<stoneCount; i++) createObj("stone");
    for(let i=0; i<bombCount; i++) createObj("bomb");
}

function createObj(type) {
    items.push({
        x: Math.random() * (canvas.width - 100) + 50,
        y: Math.random() * (canvas.height - 350) + 250,
        r: type === "gold" ? 20 + Math.random()*20 : (type === "stone" ? 25+Math.random()*30 : 30),
        type: type,
        weight: type === "stone" ? 7 : (type === "gold" ? 3 : 1),
        val: type === "gold" ? 100 : (type === "stone" ? -50 : 0)
    });
}

function update() {
    if (isWin) return;
    if (!items.find(i => i.type === "gold") && !currentItem && hookState === "swing") {
        currentLevel++;
        levelEl.innerText = currentLevel;
        initLevel(currentLevel);
        return;
    }

    if (hookState === "swing") {
        angle += swingSpeed * direction;
        if (Math.abs(angle) > 1.4) direction *= -1;
    } else if (hookState === "extend") {
        hookLen += baseSpeed;
        if (hookLen > canvas.height - 50) hookState = "retract";
        let hX = originX + Math.sin(angle) * hookLen;
        let hY = originY + Math.cos(angle) * hookLen;
        for (let i = 0; i < items.length; i++) {
            let item = items[i];
            let dx = hX - item.x;
            let dy = hY - item.y;
            if (Math.sqrt(dx*dx + dy*dy) < item.r) {
                if (item.type === "bomb") {
                    items.splice(i, 1);
                    isExploding = true;
                    score = 0; 
                    scoreEl.innerText = score;
                    setTimeout(() => isExploding = false, 600);
                    hookState = "retract";
                    return;
                }
                currentItem = items.splice(i, 1)[0];
                hookState = "retract";
                break;
            }
        }
    } else if (hookState === "retract") {
        let weightFactor = currentItem ? currentItem.weight : (isExploding ? -5 : 0);
        hookLen -= Math.max(2, baseSpeed - weightFactor);
        if (hookLen <= 60) {
            if (currentItem) {
                score += currentItem.val;
                score = Math.max(0, score);
                scoreEl.innerText = score;
                currentItem = null;
            }
            hookLen = 60;
            hookState = "swing";
        }
    }
}

function drawWinScreen() {
    // 1. åŠ¨æ€çš„æ·±æµ·æ¸å˜èƒŒæ™¯
    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
    gradient.addColorStop(0, '#001a33'); // æ·±è“è‰²
    gradient.addColorStop(0.5, '#003366'); // ä¸­é—´è“è‰²
    gradient.addColorStop(1, '#33004d'); // ç´«è‰²è°ƒ
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // 2. æ¨¡æ‹Ÿæ·±æµ·æ°”æ³¡åŠ¨ç”»
    // è¿™ä¸ªåŠ¨ç”»éœ€è¦åœ¨å…¨å±€æœ‰ä¸€ä¸ª `bubbleTimer` æˆ–åœ¨ requestAnimationFrame ä¸­è®¡ç®—æ—¶é—´
    // è¿™é‡Œç®€åŒ–ä¸ºæ¯å¸§ç»˜åˆ¶ï¼Œæ¯æ¬¡ç»˜åˆ¶ä½ç½®ç•¥æœ‰å˜åŒ–
    const numBubbles = 30;
    const bubbleSpeed = 0.5;
    const time = Date.now() * 0.001; // ç”¨äºåŠ¨ç”»çš„æ—¶é—´åŸºå‡†

    for (let i = 0; i < numBubbles; i++) {
        const bubbleX = (Math.sin(time + i) * canvas.width * 0.4) + canvas.width / 2;
        const bubbleY = (Math.cos(time * 0.5 + i) * canvas.height * 0.4) + canvas.height / 2;
        const bubbleRadius = 5 + (Math.sin(time * 2 + i) + 1) * 5;
        
        ctx.beginPath();
        ctx.arc(bubbleX, bubbleY, bubbleRadius, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(100, 200, 255, ${0.1 + Math.sin(time * 0.3 + i) * 0.05})`;
        ctx.fill();
        ctx.strokeStyle = `rgba(200, 240, 255, ${0.3 + Math.sin(time * 0.5 + i) * 0.1})`;
        ctx.lineWidth = 1;
        ctx.stroke();
    }
    
    // 3. ç»˜åˆ¶æ ¸å¿ƒä¿¡æ¯ï¼šæŠ½è±¡æç¬‘å¯çˆ±çš„ä¸€å¥è¯
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    document.getElementById('text-story').Text = i18n[currentLang].story;
    

    // æ¨¡æ‹Ÿ 3D æ•ˆæœçš„æ–‡å­—ç»˜åˆ¶
    const textDepth = 5; // æ¨¡æ‹Ÿæ–‡å­—çš„åšåº¦
    const textColor = 'rgba(255, 255, 255, 0.8)'; // ä¸»è‰²
    const shadowColor = 'rgba(0, 0, 0, 0.5)'; // é˜´å½±è‰²
    const glowColor = 'rgba(0, 243, 255, 0.7)'; // å‘å…‰è‰²

    for (let i = textDepth; i > 0; i--) {
        ctx.font = `bold ${50 + i}px 'Segoe UI', sans-serif`;
        ctx.fillStyle = `rgba(0,0,0, ${0.1 * i})`; // æ¨¡æ‹Ÿæ·±åº¦é˜´å½±
        ctx.fillText(message, canvas.width / 2 + i, canvas.height / 2 + i - 60);
    }
    
    // ä¸»æ–‡å­—
    ctx.font = `bold 55px 'Segoe UI', sans-serif`;
    ctx.fillStyle = textColor;
    ctx.shadowColor = glowColor;
    ctx.shadowBlur = 20; // æ¨¡æ‹Ÿå‘å…‰
    ctx.fillText(message, canvas.width / 2, canvas.height / 2 - 60);
    ctx.shadowBlur = 0; // é‡ç½®é˜´å½±

    // 4. ä¸­å¿ƒæ°´ç­ï¼š3D æµ®åŠ¨æ„Ÿ
    const otterSize = 120 + Math.sin(time * 0.8) * 10; // å¤§å°å‘¼å¸åŠ¨ç”»
    ctx.font = `${otterSize}px serif`;
    ctx.shadowColor = 'cyan';
    ctx.shadowBlur = 30 + Math.sin(time) * 10; // å‘¼å¸å‘å…‰
    ctx.fillStyle = 'white'; // ä½¿emojiæ›´äº®
    ctx.fillText("ğŸ¦¦", canvas.width / 2, canvas.height / 2 + 60);
    ctx.shadowBlur = 0;
    
    // ç”±äºæ­¤å‡½æ•°åœ¨ requestAnimationFrame ä¸­è¢«å¾ªç¯è°ƒç”¨ï¼Œæ‰€ä»¥æ°”æ³¡å’Œæ°´ç­çš„åŠ¨ç”»æ˜¯è‡ªç„¶çš„
    requestAnimationFrame(drawWinScreen); // ç¡®ä¿åŠ¨ç”»ç»§ç»­
}


function draw() {
    if (isWin) {
        drawWinScreen();
        return;
    }
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    // æ°´çº¹è£…é¥°
    ctx.strokeStyle = "rgba(0, 243, 255, 0.05)";
    ctx.lineWidth = 2;
    for(let i=0; i<3; i++) {
        ctx.beginPath();
        ctx.arc(originX, -50, 200 + i*100, 0, Math.PI*2);
        ctx.stroke();
    }
    // æ°´ç­
    ctx.font = "60px serif";
    ctx.textAlign = "center";
    ctx.shadowBlur = 15;
    ctx.shadowColor = "cyan";
    ctx.fillText("ğŸ¦¦", originX, originY);
    ctx.shadowBlur = 0;
    // ç»³ç´¢é’©å­
    let hX = originX + Math.sin(angle) * hookLen;
    let hY = originY + Math.cos(angle) * hookLen;
    ctx.beginPath();
    ctx.moveTo(originX, originY + 15);
    ctx.lineTo(hX, hY);
    ctx.strokeStyle = isExploding ? "#ff3e3e" : "rgba(0, 243, 255, 0.6)";
    ctx.lineWidth = 2;
    ctx.setLineDash([5, 5]);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.save();
    ctx.translate(hX, hY);
    ctx.rotate(-angle);
    ctx.font = "30px serif";
    ctx.fillText("ğŸª", 0, 15);
    ctx.restore();
    if (isExploding) {
        ctx.font = "80px serif";
        ctx.fillText("ğŸ’¥", hX, hY);
    }
    if (currentItem) {
        currentItem.x = hX;
        currentItem.y = hY + 30;
        drawItem(currentItem);
    }
    items.forEach(drawItem);
    update();
    requestAnimationFrame(draw);
}

function drawItem(item) {
    ctx.save();
    ctx.font = `${item.r * 1.2}px serif`;
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.shadowBlur = 20;
    ctx.shadowColor = item.type === "gold" ? "gold" : (item.type === "bomb" ? "red" : "transparent");
    let emoji = item.type === "gold" ? "ğŸ’°" : (item.type === "stone" ? "ğŸª¨" : "ğŸ’£");
    ctx.fillText(emoji, item.x, item.y);
    ctx.restore();
}

canvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    if (hookState === "swing" && !isWin) hookState = "extend";
}, {passive: false});

window.addEventListener('mousedown', (e) => {
    // æ’é™¤è¯­è¨€åˆ‡æ¢æŒ‰é’®çš„ç‚¹å‡»è§¦å‘é’©å­
    if (e.target.id !== 'lang-toggle' && hookState === "swing" && !isWin) {
        hookState = "extend";
    }
});

initLevel(currentLevel);
updateUILabels();
draw();
</script>
</body>
</html>
